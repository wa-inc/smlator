#!/bin/bash

# Install necessary packages
pkg update && pkg upgrade -y
pkg install wget -y
pkg install termux-tools -y

# Define the APK URL
APK_URL="https://github.com/brunodev85/winlator/releases/download/v5.0.0/Winlator_5.0.apk"

# Define the APK file name
APK_FILE="Winlator_5.0.apk"

# Define the command to launch the app
LAUNCH_COMMAND="am start --user 0 -n com.winlator/.MainActivity"

# Check if the APK file exists in the current directory
if [ ! -f "$APK_FILE" ]; then
    echo "Downloading Winlator APK..."
    wget $APK_URL
fi

# Install the APK
echo "Installing Winlator..."
termux-setup-storage
tsu
pm install $APK_FILE

# Function to show the menu
smgaming() {
    echo "1. Launch Winlator"
    echo "2. Uninstall the script"
    echo -n "Please enter your choice: "
    read choice

    case $choice in
        1)
            echo "Launching Winlator..."
            $LAUNCH_COMMAND
            ;;
        2)
            echo "Uninstalling the script..."
            rm $0
            ;;
        *)
            echo "Invalid choice."
            ;;
    esac
}

# Add smgaming function to bash profile so it can be run at any time
echo "smgaming() { $(typeset -f smgaming); }" >> ~/.bashrc

# Show the menu
smgaming
